- [基础](#%E5%9F%BA%E7%A1%80)
  - [1.1 安装](#11-%E5%AE%89%E8%A3%85)
    - [1.1.1 HomeBrew安装](#111-HomeBrew%E5%AE%89%E8%A3%85)
    - [1.1.2 docker安装](#112-docker%E5%AE%89%E8%A3%85)
  - [1.2 管理](#12-%E7%AE%A1%E7%90%86)
    - [1.2.1 用户设置](#121-%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE)
    - [1.2.2 管理MySQL的命令](#122-%E7%AE%A1%E7%90%86MySQL%E7%9A%84%E5%91%BD%E4%BB%A4)
    - [1.2.3 连接](#123-%E8%BF%9E%E6%8E%A5)
  - [1.3 数据库操作](#13-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C)
    - [1.3.1 创建数据库](#131-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93)
    - [1.3.2 删除数据库](#132-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93)
    - [1.3.3 创建数据表](#133-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8)
    - [1.3.4 删除数据表](#134-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E8%A1%A8)
    - [1.3.5 插入数据](#135-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE)
    - [1.3.6 查询数据](#136-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE)
    - [1.3.7 where 子句](#137-where-%E5%AD%90%E5%8F%A5)
    - [1.3.8 更新数据库](#138-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93)
    - [1.3.9 删除记录](#139-%E5%88%A0%E9%99%A4%E8%AE%B0%E5%BD%95)
    - [1.3.10 LIKE 子句](#1310-LIKE-%E5%AD%90%E5%8F%A5)
    - [1.3.11 排序](#1311-%E6%8E%92%E5%BA%8F)
    - [1.3.12 分组](#1312-%E5%88%86%E7%BB%84)
  - [1.4 MySQL 数据类型](#14-MySQL-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)
  - [1.5 多表查询](#15-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2)

# 基础

数据库（Database）是按照数据结构来组织、存储和管理数据的仓库，每个数据库都有一个或多个不同的API用于创建，访问，管理，搜索和复制所保存的数据。

所谓的关系型数据库，是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。

## 1.1 安装

[官网下载地址](http://www.mysql.com/downloads)

这里介绍几种其他安装方式

### 1.1.1 HomeBrew安装

    brew install mysql 

**验证安装**

    mysqladmin --version

linux上该命令将输出以下结果：

    mysqladmin  Ver 8.23 Distrib 5.0.9-0, for redhat-linux-gnu on i386

如果以上命令执行后未输入任何信息，说明你的MySQL未安装成功。

**启动**

- `sudo brew service start mysql` ：后台启动
- `sudo mysql.server start`：前台启动mysql(关闭控制台，服务停止)

**设置密码**

- `sudo mysql_secure_installation` ：设置密码

**连接**

    mysql -u root -p {pwd}

> 测试发现，brew安装很慢

### 1.1.2 docker安装

先运行容器

    docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest

查看容器运行

```bash
docker container ls
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                 NAMES
de58c162887b        mysql:latest          "docker-entrypoint..."   12 minutes ago      Up 12 minutes       3306/tcp, 33060/tcp   some-mysql
```

进入容器，操作数据库

```bash
docker exec -it some-mysql bash
mysql -u root -p
```

some-mysql 是容器名称

> 测试发现，很好用

## 1.2 管理

数据库默认有四张表

```bash
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.17 sec)
```

- **information_schema**：提供了访问数据库元数据的方式，它保存着关于MySQL服务器所维护的所有其他数据库的信息
- **mysql**：Mysql的核心数据库，类似于sql server中的master表，主要负责存储数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。(常用的，在mysql.user表中修改root用户的密码)
- **performance_schema**：主要用于收集数据库服务器性能参数。并且库里表的存储引擎均为PERFORMANCE_SCHEMA，而用户是不能创建存储引擎为PERFORMANCE_SCHEMA的表
- **sys**：Sys库所有的数据源来自performance_schema。目标是把performance_schema的把复杂度降低，让DBA能更好的阅读这个库里的内容。让DBA更快的了解DB的运行情况。 

### 1.2.1 用户设置

**添加新的用户**

允许本地IP访问localhost的Mysql数据库

```bash
mysql> create user 'editest'@'localhost' identified by 'editest123456';
Query OK, 0 rows affected (0.06 sec)
```

允许外网IP访问数据库editest，本命令包含上面的命令，是所有的IP都可以访问该数据库

```bash
mysql> create user 'editest'@'%' identified by 'editest123456';
Query OK, 0 rows affected (0.00 sec)
```

### 1.2.2 管理MySQL的命令

| 命令  | 含义  |
|---|---|
| `use [数据库名]`  | 选择要操作的MySQL数据库  |
| `show databases`  | 列出 MySQL 数据库管理系统的数据库列表  |
| `show tables`  | 显示指定数据库的所有表  |
| `show columns from [table]`  |  显示数据表的属性，属性类型，主键信息 ，是否为 NULL，默认值等其他信息 |
| `show index from [table]`  |  显示数据表的详细索引信息，包括PRIMARY KEY（主键） |
|  `show tables status like [table] \G` | 该命令将输出MySQL数据库管理系统的性能及统计信息，`\G`表示按列打印  |

### 1.2.3 连接

您可以使用MySQL二进制方式进入到MySQL命令提示符下来连接MySQL数据库。

    mysql -u root -p

退出MySQL

```bash
mysql> exit
Bye
```

也可以使用编程语言或者客户端工具，以后再介绍。

## 1.3 数据库操作

### 1.3.1 创建数据库

不需要进入数据库，使用mysqladmin

    mysqladmin -u root -p create [databases]

### 1.3.2 删除数据库

同理，使用mysqladmin，不需要进入数据库操作

```bash
root@043c12137915:/# mysqladmin -u root -p drop myDatabase
Enter password: 
Dropping the database is potentially a very bad thing to do.
Any data stored in the database will be destroyed.

Do you really want to drop the 'myDatabase' database [y/N] y
Database "myDatabase" dropped
```

### 1.3.3 创建数据表

    create table table_name (column_name column_type);

举例：

```sql
create table tutorials_tbl(
   tutorial_id INT NOT NULL AUTO_INCREMENT,
   tutorial_title VARCHAR(100) NOT NULL,
   tutorial_author VARCHAR(40) NOT NULL,
   submission_date DATE,
   PRIMARY KEY (tutorial_id)
);
```

`AUTO_INCREMENT` 定义列为自增的属性，一般用于主键，数值会自动加1。

`PRIMARY KEY` 关键字用于定义列为主键。

### 1.3.4 删除数据表

    drop table [table_name]

举例：

```sql
root@host# mysql -u root -p
Enter password:*******
mysql> use W3CSCHOOL;
Database changed
mysql> DROP TABLE w3cschool_tbl
Query OK, 0 rows affected (0.8 sec)
```

### 1.3.5 插入数据

    insert into [table_name] ([field1], [field2,...fieldN]) values ( [value1], [value2,...valueN]);

举例：

```sql
mysql> insert into tutorials (id, title, author, submission_date) values ('1', 'How to love', 'Ren Yangwei', '2019-09-22 16:08:30');
Query OK, 1 row affected, 1 warning (0.00 sec)
```

### 1.3.6 查询数据

语法：

```sql
SELECT column_name,column_name FROM [table_name] [WHERE Clause] [OFFSET M ][LIMIT N]
```

- 查询语句中你可以使用一个或者多个表，表之间使用逗号(,)分割，并使用WHERE语句来设定查询条件。
- SELECT 命令可以读取一条或者多条记录。
- 你可以使用星号（*）来代替其他字段，SELECT语句会返回表的所有字段数据
- 你可以使用 WHERE 语句来包含任何条件。
- 你可以通过OFFSET指定SELECT语句开始查询的数据偏移量。默认情况下偏移量为0。
- 你可以使用 LIMIT 属性来设定返回的记录数。

举例：

```sql
mysql> select * from tutorials;
+----+-------------+-------------+-----------------+
| id | title       | author      | submission_date |
+----+-------------+-------------+-----------------+
|  1 | How to love | Ren Yangwei | 2019-09-22      |
+----+-------------+-------------+-----------------+
1 row in set (0.00 sec)
```

### 1.3.7  where 子句

语法：

```sql
SELECT field1, field2,...fieldN FROM table_name1, table_name2...
[WHERE condition1 [AND [OR]] condition2.....
```

- 查询语句中你可以使用一个或者多个表，表之间使用逗号(,)分割，并使用WHERE语句来设定查询条件。
- 你可以在WHERE子句中指定任何条件。
- 你可以使用AND或者OR指定一个或多个条件。
- WHERE子句也可以运用于SQL的 DELETE 或者 UPDATE 命令。
- WHERE 子句类似于程序语言中的if条件，根据 MySQL 表中的字段值来读取指定的数据。

> 使用主键来作为 WHERE 子句的条件查询非常快速。

### 1.3.8 更新数据库

语法：

```sql
UPDATE table_name SET field1=new-value1, field2=new-value2
[WHERE Clause]
```

- 你可以同时更新一个或多个字段。
- 你可以在 WHERE 子句中指定任何条件。
- 你可以在一个单独表中同时更新数据。

举例：

```sql
mysql> update tutorials set author='Ren';
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0
```

### 1.3.9 删除记录

语法：

```sql
DELETE FROM table_name [WHERE Clause]
```

- 如果没有指定 WHERE 子句，MySQL表中的所有记录将被删除。
- 你可以在 WHERE 子句中指定任何条件
- 您可以在单个表中一次性删除记录。

### 1.3.10 LIKE 子句

LIKE 子句中使用百分号(%)字符来表示任意字符，类似于UNIX或正则表达式中的星号 (*)。

如果没有使用百分号(%), LIKE 子句与等号（=）的效果是一样的。

```sql
SELECT field1, field2,...fieldN 
FROM table_name1, table_name2...
WHERE field1 LIKE condition1 [AND [OR]] filed2 = 'somevalue'
```

- 你可以在WHERE子句中指定任何条件。
- 你可以在WHERE子句中使用LIKE子句。
- 你可以使用LIKE子句代替等号(=)。
- LIKE 通常与 % 一同使用，类似于一个元字符的搜索。
- 你可以使用AND或者OR指定一个或多个条件。
- 你可以在 DELETE 或 UPDATE 命令中使用 WHERE...LIKE 子句来指定条件。

举例：

```sql
mysql> select * from tutorials where title like '%How%';
+----+----------------+-------------+-----------------+
| id | title          | author      | submission_date |
+----+----------------+-------------+-----------------+
|  1 | How to love    | Ren         | 2019-09-22      |
|  2 | How to give up | Ren Yangwei | 2019-09-21      |
+----+----------------+-------------+-----------------+
2 rows in set (0.00 sec)
```

### 1.3.11 排序

我们可以使用MySQL的 `ORDER BY` 子句来设定你想按哪个字段哪中方式来进行排序，再返回搜索结果。

语法：

```sql
SELECT field1, field2,...fieldN FROM table_name1, table_name2...
ORDER BY field1, [field2...] [ASC [DESC]]
```

- 你可以使用任何字段来作为排序的条件，从而返回排序后的查询结果。
- 你可以设定多个字段来排序。
- 你可以使用 ASC 或 DESC 关键字来设置查询结果是按升序或降序排列。 默认情况下，它是按升排列。
- 你可以添加 WHERE...LIKE 子句来设置条件。

举例：

```sql
mysql> select * from tutorials order by submission_date;
+----+----------------+-------------+-----------------+
| id | title          | author      | submission_date |
+----+----------------+-------------+-----------------+
|  2 | How to give up | Ren Yangwei | 2019-09-21      |
|  3 | Too hard       | Ren Yangwei | 2019-09-21      |
|  1 | How to love    | Ren         | 2019-09-22      |
+----+----------------+-------------+-----------------+
3 rows in set (0.00 sec)
```

### 1.3.12 分组

GROUP BY 语句根据一个或多个列对结果集进行分组。

在分组的列上我们可以使用 COUNT, SUM, AVG,等函数。

```sql
SELECT column_name, function(column_name)
FROM table_name
WHERE column_name operator value
GROUP BY column_name;
```

举例：查找名字出现的次数

```sql
mysql> select name, count(*) from employee_tbl group by name;
+----------+----------+
| name     | count(*) |
+----------+----------+
| xiaoming |        1 |
| Lily     |        1 |
| HuYa     |        1 |
| Cendy    |        2 |
| Bily     |        1 |
+----------+----------+
5 rows in set (0.00 sec)
```

**使用 WITH ROLLUP**

WITH ROLLUP 可以实现在分组统计数据基础上再进行相同的统计（SUM,AVG,COUNT…）。

例如我们将以上的数据表按名字进行分组，再统计每个人登录的次数：

```sql
mysql> SELECT name, SUM(singin) as singin_count FROM  employee_tbl GROUP BY name WITH ROLLUP;
+----------+--------------+
| name     | singin_count |
+----------+--------------+
| Bily     |            2 |
| Cendy    |            8 |
| HuYa     |            2 |
| Lily     |            3 |
| xiaoming |            1 |
| NULL     |           16 |
+----------+--------------+
6 rows in set (0.01 sec)
```

其中记录 NULL 表示所有人的登录次数。

## 1.4 MySQL 数据类型

MySQL支持多种类型，大致可以分为三类：**数值**、**日期/时间**和 **字符串(字符)** 类型。其中每种数据类型又有不同存储范围。

具体参考 [MySQL数据类型](https://www.w3cschool.cn/mysql/mysql-data-types.html)


## 1.5 多表查询

